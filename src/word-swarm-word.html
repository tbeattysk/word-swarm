<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer/lib/mixins/gesture-event-listeners.html">


<dom-module id="word-swarm-word">
  <template>
    <style>
        :host{
            position: absolute;
            cursor: -webkit-grab;
             -webkit-user-drag: element;
            top:33px;
            left: 44px;
            user-select: none;
        }
        #box {
          position: relative;
          display: inline-block;
          margin: 0px;
          padding: 4px;
          border-radius: 2px;
          backface-visibility: hidden;
          -webkit-font-smoothing: subpixel-antialiased;
          -webkit-transition: all 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
          transition: all 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
          opacity: 1;
        }
        #box:hover, #box.holding{
          background-color:#fff;
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
          transform: scale(1.1, 1.1);
        }
    </style>

    <div id="box" class="box" on-down="_hold" on-up="_release">
            <slot></slot>
      <div>
  </template>

  <script>
    class wordSwarmWord extends Polymer.GestureEventListeners(Polymer.Element) {
    static get is() { return 'word-swarm-word'; }
     
    constructor() {
        super();
        Polymer.Gestures.addListener(this, 'tap', e => this.handleTap(e));
        Polymer.Gestures.addListener(this, 'down', e => this._hold(e));
        requestAnimationFrame(this._installListeners.bind(this));
        
    }

    static get properties(){
      return{
          name:{type: Object},
          holding:{type: Boolean,
            notify:true,
            reflectToAttribute: true,
            observer:"_changeHold"
          },
          tap:{
            type: Boolean,
          }
      }
    }
    _installListeners(){
        this.addEventListener('mouseover', this._onHover);
        this.addEventListener('mouseout', this._onUnhover);
    }
    _onHover(){
      this._hold();
    }
    _onUnhover(){
      this._release();
    }
    _hold(){
      console.log("hold")
       this.tap = true
       setTimeout(()=>{
          this.tap = false;
        }, 500);
       this.dispatchEvent(new CustomEvent('stopMe',{detail:this,bubbles: true, composed: true}));
    }
    _release(){
      if(this.tap){
        this.dispatchEvent(new CustomEvent('chooseMe',{detail:this,bubbles: true, composed: true}));
      }
      else{
        this.dispatchEvent(new CustomEvent('releaseMe',{detail:this,bubbles: true, composed: true}));
      }
    }
    _changeHold(){
      if(this.holding == true){
        this.$.box.className ="holding";
      }else{
        this.$.box.className ="";
      }
    }
      
    };
    customElements.define(wordSwarmWord.is, wordSwarmWord);
  </script>
</dom-module>
